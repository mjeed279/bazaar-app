# مشروع Bazaar - دليل مرجعي شامل

## نظرة عامة على المشروع

مشروع Bazaar هو تطبيق وسيط بين العملاء وعلي إكسبريس، يتيح للمستخدمين تصفح وشراء منتجات من علي إكسبريس مع إضافة هامش ربح 30% دون معرفة العملاء أن التطبيق وسيط. يدعم المشروع منصات الويب وiOS وAndroid، ويستبعد المنتجات الممنوعة من الدخول إلى السعودية.

## هيكل المشروع

```
bazaar/
├── backend/                  # الخادم الخلفي (Node.js)
│   ├── src/
│   │   ├── controllers/      # وحدات التحكم
│   │   ├── models/           # النماذج
│   │   ├── routes/           # المسارات
│   │   ├── services/         # الخدمات
│   │   ├── utils/            # الأدوات المساعدة
│   │   └── config/           # ملفات التكوين
│   ├── .env.example          # نموذج لملف البيئة
│   └── package.json          # تبعيات الخادم الخلفي
├── frontend/                 # تطبيق الويب الأمامي (Next.js)
│   ├── public/               # الملفات العامة
│   ├── src/
│   │   ├── components/       # المكونات
│   │   ├── pages/            # الصفحات
│   │   ├── styles/           # الأنماط
│   │   ├── utils/            # الأدوات المساعدة
│   │   ├── hooks/            # الخطافات
│   │   └── context/          # سياقات React
│   ├── package.json          # تبعيات الواجهة الأمامية
│   ├── tailwind.config.js    # تكوين Tailwind CSS
│   └── postcss.config.js     # تكوين PostCSS
├── mobile/                   # تطبيق الموبايل (React Native)
│   ├── src/
│   │   ├── screens/          # شاشات التطبيق
│   │   ├── components/       # المكونات
│   │   ├── navigation/       # التنقل
│   │   ├── utils/            # الأدوات المساعدة
│   │   ├── api/              # واجهة برمجة التطبيقات
│   │   ├── assets/           # الأصول
│   │   ├── hooks/            # الخطافات
│   │   └── context/          # سياقات React
│   └── package.json          # تبعيات تطبيق الموبايل
├── docs/                     # الوثائق
│   ├── requirements.md       # متطلبات المشروع
│   └── api/                  # وثائق واجهة برمجة التطبيقات
├── .gitignore                # ملفات مستثناة من Git
├── README.md                 # ملف القراءة الرئيسي
└── todo.md                   # قائمة المهام
```

## الخطوات المنجزة

### 1. تحليل المتطلبات وإعداد البيئة

- [x] تحليل متطلبات المشروع وتوثيقها في `docs/requirements.md`
- [x] تحديد المتطلبات الوظيفية وغير الوظيفية
- [x] تحديد التقنيات والأدوات المستخدمة

### 2. إنشاء هيكل المشروع وتهيئة المستودعات

- [x] إنشاء هيكل المشروع الأساسي
- [x] تهيئة مستودع Git محلي
- [x] ربط المستودع المحلي بمستودع GitHub

### 3. تطوير تكامل واجهة برمجة التطبيقات مع علي إكسبريس

- [x] إنشاء خدمة للتكامل مع واجهة برمجة تطبيقات علي إكسبريس
- [x] تطوير وحدات التحكم والطرق للمنتجات والفئات والطلبات
- [x] تطوير وظائف جلب المنتجات والبحث والتصفية

### 4. تنفيذ تصفية المنتجات للسعودية

- [x] تحديد قائمة المنتجات الممنوعة
- [x] تطوير آلية تصفية المنتجات
- [x] دمج آلية التصفية مع خدمة علي إكسبريس

### 5. تطوير تطبيق الويب الأمامي

- [x] تصميم واجهة المستخدم
- [x] تطوير صفحات المنتجات
- [x] تطوير صفحة سلة التسوق
- [x] تطوير نظام الدفع
- [x] إنشاء مكونات واجهة المستخدم

### 6. تنفيذ تصميم متجاوب للموبايل

- [x] تحسين مكون Header ليناسب الأجهزة المحمولة
- [x] تحسين مكون Footer ليناسب الأجهزة المحمولة
- [x] تحسين مكون ProductCard ليناسب الأجهزة المحمولة
- [x] تحسين صفحة البحث لتكون متجاوبة مع الأجهزة المحمولة
- [ ] إعداد مشروع React Native لتطبيقات iOS وAndroid (جاري العمل)
- [ ] تطوير واجهات تطبيق الموبايل

## تفاصيل التنفيذ

### الخادم الخلفي (Backend)

#### تكامل علي إكسبريس

تم تطوير خدمة `aliexpressService.js` للتكامل مع واجهة برمجة تطبيقات علي إكسبريس، وتتضمن الوظائف التالية:

- البحث عن المنتجات
- جلب تفاصيل المنتج
- جلب الفئات
- إنشاء طلبات

```javascript
// backend/src/services/aliexpressService.js
const axios = require('axios');
const crypto = require('crypto');
const aliexpressConfig = require('../config/aliexpressConfig');
const prohibitedProductsFilter = require('../utils/prohibitedProductsFilter');

class AliExpressService {
  constructor() {
    this.baseUrl = aliexpressConfig.baseUrl;
    this.appKey = aliexpressConfig.appKey;
    this.appSecret = aliexpressConfig.appSecret;
    this.trackingId = aliexpressConfig.trackingId;
  }

  // توقيع الطلب
  generateSignature(params) {
    // تنفيذ توقيع الطلب حسب متطلبات واجهة برمجة تطبيقات علي إكسبريس
  }

  // البحث عن المنتجات
  async searchProducts(keywords, options = {}) {
    // تنفيذ البحث عن المنتجات
    // تطبيق تصفية المنتجات الممنوعة
    // إضافة هامش الربح 30%
  }

  // جلب تفاصيل المنتج
  async getProductDetails(productId) {
    // جلب تفاصيل المنتج
    // إضافة هامش الربح 30%
  }

  // جلب الفئات
  async getCategories() {
    // جلب الفئات من علي إكسبريس
  }

  // إنشاء طلب
  async createOrder(orderData) {
    // إنشاء طلب في علي إكسبريس
  }

  // تحويل منتج من تنسيق علي إكسبريس إلى تنسيق Bazaar
  transformProduct(product) {
    // تحويل بيانات المنتج
    // إضافة هامش الربح 30%
    // التحقق من أن المنتج غير ممنوع
  }
}

module.exports = new AliExpressService();
```

#### تصفية المنتجات الممنوعة

تم تطوير آلية لتصفية المنتجات الممنوعة في السعودية في ملف `prohibitedProductsFilter.js`:

```javascript
// backend/src/utils/prohibitedProductsFilter.js
const prohibitedKeywords = [
  'كحول', 'خمر', 'نبيذ', 'بيرة', 'مشروبات روحية',
  'لحم خنزير', 'خنزير', 'لحم الخنزير',
  'مخدرات', 'حشيش', 'ماريجوانا', 'كوكايين',
  'أسلحة', 'مسدس', 'بندقية', 'ذخيرة',
  'مواد إباحية', 'جنسي صريح',
  'تبغ', 'سجائر إلكترونية', 'فيب',
  'مقامرة', 'قمار', 'كازينو',
  'تجسس', 'تنصت', 'اختراق',
  'عملات مزيفة', 'أوراق نقدية مقلدة',
  'منتجات مقلدة', 'مزيفة', 'مقلدة'
];

const prohibitedCategories = [
  '200003484', // الكحول
  '200003482', // منتجات التبغ
  '200003483', // المخدرات
  '200003481', // الأسلحة
  '200003480', // المواد الإباحية
];

function isProhibitedProduct(product) {
  // التحقق من الكلمات المفتاحية الممنوعة في عنوان ووصف المنتج
  // التحقق من الفئات الممنوعة
}

function filterProhibitedProducts(products) {
  // تصفية قائمة المنتجات لاستبعاد المنتجات الممنوعة
}

module.exports = {
  isProhibitedProduct,
  filterProhibitedProducts,
  prohibitedKeywords,
  prohibitedCategories
};
```

### الواجهة الأمامية (Frontend)

#### مكونات واجهة المستخدم

تم تطوير مكونات واجهة المستخدم التالية:

1. **Layout**: المكون الرئيسي الذي يحتوي على Header وFooter
2. **Header**: شريط التنقل العلوي مع قائمة منسدلة للموبايل
3. **Footer**: تذييل الصفحة مع روابط وتفاصيل الاتصال
4. **ProductCard**: بطاقة عرض المنتج مع صورة وسعر وتقييم
5. **CategoryList**: قائمة الفئات
6. **FeaturedProducts**: عرض المنتجات المميزة
7. **SearchBar**: شريط البحث

#### الصفحات

تم تطوير الصفحات التالية:

1. **الصفحة الرئيسية**: عرض المنتجات المميزة والفئات
2. **صفحة تفاصيل المنتج**: عرض تفاصيل المنتج وصوره وخيارات الشراء
3. **صفحة البحث**: البحث عن المنتجات مع خيارات التصفية والترتيب
4. **صفحة سلة التسوق**: عرض المنتجات في السلة وإدارتها
5. **صفحة الدفع**: إكمال عملية الشراء وإدخال بيانات الشحن والدفع
6. **صفحة نجاح الطلب**: تأكيد نجاح الطلب وعرض التفاصيل

#### التصميم المتجاوب

تم تحسين التصميم ليكون متجاوباً مع الأجهزة المحمولة من خلال:

1. استخدام Tailwind CSS للتصميم المتجاوب
2. إضافة قائمة منسدلة في Header للموبايل
3. تعديل تخطيط الصفحات ليناسب الشاشات الصغيرة
4. تحسين حجم النصوص والأزرار للأجهزة المحمولة
5. إخفاء بعض العناصر غير الضرورية في الشاشات الصغيرة

### تطبيق الموبايل (Mobile)

بدأنا في إعداد مشروع React Native لتطبيقات iOS وAndroid:

1. إنشاء هيكل المشروع
2. تكوين ملف package.json مع التبعيات اللازمة
3. إنشاء ملف api.js للتكامل مع الخادم الخلفي
4. تطوير مكون ProductCard للموبايل

## الخطوات القادمة

1. **إكمال تطوير تطبيق الموبايل**:
   - تطوير شاشات التطبيق (الرئيسية، تفاصيل المنتج، سلة التسوق، الدفع)
   - تطوير نظام التنقل
   - تطوير مكونات إضافية

2. **إعداد معالجة الدفع مع هامش الربح**:
   - تكامل مع بوابات الدفع
   - تنفيذ آلية هامش الربح 30%
   - إدارة المعاملات والطلبات

3. **النشر على Vercel وGitHub**:
   - نشر الواجهة الأمامية على Vercel
   - نشر الخادم الخلفي
   - نشر تطبيقات الموبايل

4. **التحقق من الوظائف وإنهاء المشروع**:
   - اختبار جميع الوظائف
   - التأكد من تصفية المنتجات الممنوعة
   - التحقق من هامش الربح 30%
   - إصلاح الأخطاء وتحسين الأداء

## ملاحظات هامة

- يجب الحفاظ على سرية العلاقة مع علي إكسبريس عن العملاء
- يجب التأكد من تصفية جميع المنتجات الممنوعة في السعودية
- يجب تطبيق هامش الربح 30% على جميع المنتجات
- يجب أن يكون التصميم متجاوباً مع جميع الأجهزة
